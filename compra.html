<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>üõí Listas de Compras</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f4f6fb;
  --card:#fff;
  --primary:#4f46e5;
  --danger:#ef4444;
  --edit:#10b981;
  --text:#1f2937;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:var(--text)}
header{
  background:var(--card);
  padding:1rem;
  display:flex;
  justify-content:space-between;
}
button{
  border:none;
  padding:.4rem .8rem;
  border-radius:8px;
  color:#fff;
  cursor:pointer;
}
button.primary{background:var(--primary)}
button.danger{background:var(--danger)}
button.edit{background:var(--edit)}
button.secondary{background:#6b7280}
main{
  display:grid;
  grid-template-columns:280px 1fr;
  gap:1rem;
  padding:1rem;
}
aside,section{
  background:var(--card);
  padding:1rem;
  border-radius:16px;
}
ul{list-style:none;padding:0}
#lists li{
  padding:.6rem;
  border-radius:10px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  margin-bottom:.4rem;
}
#lists li.active{background:var(--primary);color:#fff}
#lists li.closed{opacity:.6}

form{
  display:grid;
  grid-template-columns:2fr 1fr 1fr 1fr auto;
  gap:.4rem;
}
input,select{
  padding:.4rem;
}
#products li{
  display:grid;
  grid-template-columns:2fr 1fr 1fr 1fr auto auto;
  gap:.4rem;
  background:#eee;
  padding:.4rem;
  margin:.3rem 0;
  border-radius:8px;
}
.total{
  text-align:right;
  font-size:1.3rem;
  font-weight:bold;
}
.actions{
  display:flex;
  justify-content:flex-end;
  gap:.5rem;
  margin-top:1rem;
}
@media(max-width:768px){
  main{grid-template-columns:1fr}
  form{grid-template-columns:1fr}
  #products li{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header>
  <h2>üõí Listas de Compras</h2>
  <button id="newList" class="primary">‚ûï Nueva Lista</button>
</header>

<main>
<aside>
  <h3>Mis listas</h3>
  <ul id="lists"></ul>
</aside>

<section>
  <h3 id="title">Selecciona una lista</h3>

  <form id="form">
    <input id="name" placeholder="Producto" required>
    <input id="qty" type="number" step="any" min="0.01" placeholder="Cantidad" required>
    <input id="price" type="number" step="any" min="0" placeholder="Precio" required>
    <select id="type">
      <option value="unit">Unitario</option>
      <option value="total">Total</option>
    </select>
    <button class="primary">Agregar</button>
  </form>

  <ul id="products"></ul>

  <div class="total">
    TOTAL: <span id="total">$0.00</span>
  </div>

  <div class="actions">
    <button id="closeList" class="secondary">Cerrar lista</button>
    <button id="deleteList" class="danger">Eliminar lista</button>
  </div>
</section>
</main>

<script>
let lists = JSON.parse(localStorage.getItem('shopping_lists')) || {};
let current = null;
let editingIndex = null;

const $ = id => document.getElementById(id);
const save = () => localStorage.setItem('shopping_lists', JSON.stringify(lists));
const money = n => n.toLocaleString('es-MX',{style:'currency',currency:'MXN'});

function listTotal(list){
  return list.products.reduce((s,p)=>s+p.qty*p.unit,0);
}

function renderLists(){
  $('lists').innerHTML='';
  Object.keys(lists).forEach(id=>{
    const l=lists[id];
    const li=document.createElement('li');
    li.className=(id===current?'active ':'')+(l.closed?'closed':'');
    li.innerHTML=`<span>${l.name}${l.closed?' üîí':''}</span><strong>${money(listTotal(l))}</strong>`;
    li.onclick=()=>openList(id);
    $('lists').appendChild(li);
  });
}

function openList(id){
  current=id;
  editingIndex=null;
  $('title').textContent=lists[id].name;
  renderLists();
  renderProducts();
}

function renderProducts(){
  const l=lists[current];
  $('products').innerHTML='';
  let total=0;

  l.products.forEach((p,i)=>{
    const sub=p.qty*p.unit;
    total+=sub;
    const li=document.createElement('li');

    if(editingIndex===i){
      li.innerHTML=`
        <input value="${p.name}">
        <input type="number" step="any" value="${p.qty}">
        <input type="number" step="any" value="${p.unit}">
        <select>
          <option value="unit">Unitario</option>
          <option value="total">Total</option>
        </select>
        <button class="edit">üíæ</button>
        <button class="secondary">‚ùå</button>
      `;

      li.querySelector('.edit').onclick=()=>{
        const inputs=li.querySelectorAll('input');
        const select=li.querySelector('select');

        const newName=inputs[0].value.trim();
        const newQty=parseFloat(inputs[1].value);
        const price=parseFloat(inputs[2].value);
        const type=select.value;

        if(!newName || newQty<=0 || price<0) return;

        p.name=newName;
        p.qty=newQty;
        p.unit=type==='unit'?price:price/newQty;

        editingIndex=null;
        save();
        renderProducts();
        renderLists();
      };

      li.querySelector('.secondary').onclick=()=>{
        editingIndex=null;
        renderProducts();
      };

    } else {
      li.innerHTML=`
        <span>${p.name}</span>
        <span>${p.qty}</span>
        <span>${money(p.unit)}</span>
        <strong>${money(sub)}</strong>
        ${l.closed?'':'<button class="edit">‚úèÔ∏è</button>'}
        ${l.closed?'':'<button class="danger">‚ùå</button>'}
      `;

      if(!l.closed){
        li.querySelector('.edit').onclick=()=>{ editingIndex=i; renderProducts(); };
        li.querySelector('.danger').onclick=()=>{
          l.products.splice(i,1);
          save();
          renderProducts();
          renderLists();
        };
      }
    }
    $('products').appendChild(li);
  });

  $('total').textContent=money(total);
  $('form').style.display=l.closed?'none':'grid';
}

$('newList').onclick=()=>{
  const name=prompt('Nombre de la lista');
  if(!name) return;
  const id=Date.now().toString();
  lists[id]={name,products:[],closed:false};
  save();
  openList(id);
};

$('form').onsubmit=e=>{
  e.preventDefault();
  const name=$('name').value;
  const qty=parseFloat($('qty').value);
  const price=parseFloat($('price').value);
  const type=$('type').value;
  const unit=type==='unit'?price:price/qty;
  lists[current].products.push({name,qty,unit});
  save();
  renderProducts();
  renderLists();
  e.target.reset();
};

$('closeList').onclick=()=>{
  lists[current].closed=true;
  save();
  renderProducts();
  renderLists();
};

$('deleteList').onclick=()=>{
  if(!lists[current].closed) return alert('Solo listas cerradas');
  delete lists[current];
  current=null;
  save();
  renderLists();
  $('products').innerHTML='';
  $('total').textContent='$0.00';
  $('title').textContent='Selecciona una lista';
};

renderLists();
const ids=Object.keys(lists);
if(ids.length) openList(ids[0]);
</script>

</body>
</html>
