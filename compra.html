<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>üõí Listas de Compras</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f4f6fb;
  --card:#fff;
  --primary:#4f46e5;
  --danger:#ef4444;
  --text:#1f2937;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:var(--text)}
header{
  background:var(--card);
  padding:1rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:.5rem 1rem;
  border-radius:10px;
  cursor:pointer;
}
button.danger{background:var(--danger)}
button.secondary{background:#6b7280}
main{
  display:grid;
  grid-template-columns:280px 1fr;
  gap:1rem;
  padding:1rem;
}
aside,section{
  background:var(--card);
  padding:1rem;
  border-radius:16px;
}
ul{list-style:none;padding:0}
#lists li{
  padding:.6rem;
  border-radius:10px;
  cursor:pointer;
  margin-bottom:.4rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:.95rem;
}
#lists li.active{background:var(--primary);color:#fff}
#lists li.closed{opacity:.6}
.list-total{
  font-weight:bold;
  font-size:.9rem;
}
form{
  display:grid;
  grid-template-columns:2fr 1fr 1fr 1fr auto;
  gap:.4rem;
  margin-bottom:1rem;
}
input,select{padding:.5rem}
#products li{
  display:grid;
  grid-template-columns:2fr 1fr 1fr 1fr auto;
  gap:.4rem;
  background:#eee;
  margin:.3rem 0;
  padding:.4rem;
  border-radius:8px;
}
.total{
  text-align:right;
  font-size:1.3rem;
  font-weight:bold;
}
.actions{
  display:flex;
  gap:.5rem;
  justify-content:flex-end;
  margin-top:1rem;
}
@media(max-width:768px){
  main{grid-template-columns:1fr}
  form{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header>
  <h2>üõí Listas de Compras</h2>
  <button id="newList">‚ûï Nueva Lista</button>
</header>

<main>
  <aside>
    <h3>Mis listas</h3>
    <ul id="lists"></ul>
  </aside>

  <section>
    <h3 id="title">Selecciona una lista</h3>

    <form id="form">
      <input id="name" placeholder="Producto" required>
      <input id="qty" type="number" step="any" min="0.01" placeholder="Cantidad" required>
      <input id="price" type="number" step="any" min="0" placeholder="Precio" required>
      <select id="type">
        <option value="unit">Precio unitario</option>
        <option value="total">Precio total</option>
      </select>
      <button type="submit">Agregar</button>
    </form>

    <ul id="products"></ul>

    <div class="total">
      TOTAL LISTA: <span id="total">$0.00</span>
    </div>

    <div class="actions">
      <button id="closeList" class="secondary">Cerrar lista</button>
      <button id="deleteList" class="danger">Eliminar lista</button>
    </div>
  </section>
</main>

<script>
/* ===============================
   ESTADO
================================ */
let lists = JSON.parse(localStorage.getItem('shopping_lists')) || {};
let current = null;

/* ===============================
   UTIL
================================ */
const $ = id => document.getElementById(id);
const save = () => localStorage.setItem('shopping_lists', JSON.stringify(lists));
const money = n => n.toLocaleString('es-MX',{style:'currency',currency:'MXN'});

/* ===============================
   CALCULAR TOTAL LISTA
================================ */
function listTotal(list){
  return list.products.reduce((sum,p)=>sum + (p.qty*p.unit),0);
}

/* ===============================
   LISTAS
================================ */
function renderLists(){
  $('lists').innerHTML='';
  Object.keys(lists).forEach(id=>{
    const l = lists[id];
    const li=document.createElement('li');

    li.classList.toggle('active',id===current);
    li.classList.toggle('closed',l.closed);

    li.innerHTML=`
      <span>${l.name}${l.closed?' üîí':''}</span>
      <span class="list-total">${money(listTotal(l))}</span>
    `;

    li.onclick=()=>openList(id);
    $('lists').appendChild(li);
  });
}

function openList(id){
  current=id;
  $('title').textContent=lists[id].name;
  renderLists();
  renderProducts();
}

/* ===============================
   PRODUCTOS
================================ */
function renderProducts(){
  const l=lists[current];
  $('products').innerHTML='';
  let total=0;

  l.products.forEach((p,i)=>{
    const sub=p.qty*p.unit;
    total+=sub;

    const li=document.createElement('li');
    li.innerHTML=`
      <span>${p.name}</span>
      <span>${p.qty}</span>
      <span>${money(p.unit)}</span>
      <strong>${money(sub)}</strong>
      ${l.closed?'':'<button class="danger">‚ùå</button>'}
    `;

    if(!l.closed){
      li.querySelector('button').onclick=()=>{
        l.products.splice(i,1);
        save();
        renderProducts();
        renderLists();
      };
    }

    $('products').appendChild(li);
  });

  $('total').textContent=money(total);
  $('form').style.display=l.closed?'none':'grid';
}

/* ===============================
   NUEVA LISTA
================================ */
$('newList').onclick=()=>{
  const name=prompt('Nombre de la lista');
  if(!name) return;

  const id=Date.now().toString();
  lists[id]={name,products:[],closed:false};
  save();
  openList(id);
};

/* ===============================
   AGREGAR PRODUCTO
================================ */
$('form').onsubmit=e=>{
  e.preventDefault();
  if(!current) return;

  const name=$('name').value.trim();
  const qty=parseFloat($('qty').value);
  const price=parseFloat($('price').value);
  const type=$('type').value;

  if(!name||qty<=0||price<0) return;

  const unit = type==='unit'?price:price/qty;

  lists[current].products.push({name,qty,unit});
  save();
  renderProducts();
  renderLists();
  e.target.reset();
};

/* ===============================
   CERRAR / ELIMINAR
================================ */
$('closeList').onclick=()=>{
  if(!current) return;
  lists[current].closed=true;
  save();
  renderProducts();
  renderLists();
};

$('deleteList').onclick=()=>{
  if(!current) return;
  if(!lists[current].closed){
    alert('Solo puedes eliminar listas cerradas');
    return;
  }
  if(!confirm('¬øEliminar esta lista?')) return;

  delete lists[current];
  current=null;
  save();
  $('products').innerHTML='';
  $('total').textContent='$0.00';
  $('title').textContent='Selecciona una lista';
  renderLists();
};

/* ===============================
   INIT
================================ */
renderLists();
const ids=Object.keys(lists);
if(ids.length) openList(ids[0]);
</script>

</body>
</html>
