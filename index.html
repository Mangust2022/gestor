<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inventario de Casa</title>
  <style>
    body{font-family:'Segoe UI',sans-serif;margin:0;padding:0;background:#f1f5f9;color:#333;}
    header{background:linear-gradient(135deg,#1e3a8a,#2563eb);color:white;
      padding:18px;text-align:center;font-size:1.4em;font-weight:bold;
      box-shadow:0 2px 8px rgba(0,0,0,.2);}
    main{padding:15px;}

    .btn{padding:10px 14px;border:none;border-radius:8px;cursor:pointer;
      font-size:15px;font-weight:500;transition:.2s;}
    .btn-primary{background:#2563eb;color:#fff;}
    .btn-primary:hover{background:#1d4ed8;}
    .btn-danger{background:#dc2626;color:#fff;}
    .btn-danger:hover{background:#b91c1c;}
    .btn-gray{background:#9ca3af;color:#fff;}
    .btn-gray:hover{background:#6b7280;}
    .btn-sm{padding:6px 10px;font-size:13px;}

    .card{background:#fff;border-radius:10px;box-shadow:0 1px 6px rgba(0,0,0,.12);
      padding:12px 14px;margin-bottom:10px;display:flex;justify-content:space-between;
      align-items:center;flex-wrap:wrap;gap:10px;}
    .info{flex:1;min-width:150px;}
    .name{font-weight:600;font-size:16px;}
    .details{font-size:13px;color:#555;margin-top:2px;}
    .low{color:#dc2626;font-weight:bold;font-size:13px;}

    .cat-title{font-weight:bold;font-size:18px;margin:20px 0 10px;padding:8px 12px;
      background:#e0e7ff;color:#1e3a8a;border-radius:8px;}
    .resumen{font-size:14px;color:#444;margin:5px 0 15px 5px;}

    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,.5);justify-content:center;align-items:center;z-index:1000;}
    .modal-card{background:#fff;border-radius:12px;padding:20px;width:90%;max-width:420px;}
    .form-row{margin-bottom:12px;}
    input,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;font-size:15px;}

    #topBar{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:15px;}
    #search{flex:1;padding:10px;font-size:15px;border-radius:8px;border:1px solid #ccc;}
  </style>
</head>

<body>
<header>üì¶ Inventario de Casa</header>

<main>
  <div id="topBar">
    <input id="search" placeholder="Buscar por nombre o categor√≠a...">
    <button class="btn btn-primary" onclick="openAdd()">+ Agregar</button>
    <button class="btn btn-gray" onclick="exportCSV()">üì• Exportar</button>
    <button class="btn btn-danger" onclick="goToCompra()">üìù Lista de compra</button>
  </div>
  <div id="list"></div>
</main>

<!-- Modal Agregar -->
<div id="modalAdd" class="modal">
  <div class="modal-card">
    <h2>Agregar Producto</h2>
    <div class="form-row"><input id="addName" placeholder="Nombre"></div>
    <div class="form-row"><input id="addQty" type="number" step="0.01" placeholder="Cantidad"></div>
    <div class="form-row"><input id="addMin" type="number" step="0.01" placeholder="Stock m√≠nimo"></div>
    <div class="form-row">
      <select id="addUnit">
        <option value="pieza">Pieza</option>
        <option value="kg">Kg</option>
        <option value="g">Gramos</option>
        <option value="L">Litro</option>
        <option value="ml">Mililitro</option>
      </select>
    </div>
    <div class="form-row">
      <select id="addCat">
        <option>General</option>
        <option>Cocina</option>
        <option>Limpieza</option>
        <option>Comida</option>
        <option>Ba√±o</option>
      </select>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" style="flex:1" onclick="addItem()">Guardar</button>
      <button class="btn btn-gray" style="flex:1" onclick="closeAdd()">Cancelar</button>
    </div>
  </div>
</div>

<script>
const q=s=>document.querySelector(s);
const list=q("#list");
let data=JSON.parse(localStorage.getItem("invCasa")||"[]");
let searchTerm="";

function goToCompra(){
  window.location.href="compra.html";
}

function save(){
  localStorage.setItem("invCasa",JSON.stringify(data));
  render();
}

function render(){
  list.innerHTML="";
  let filtered=data.filter(it=>{
    if(!searchTerm)return true;
    return it.name.toLowerCase().includes(searchTerm) ||
           it.cat.toLowerCase().includes(searchTerm);
  });

  if(filtered.length===0){
    list.innerHTML="<p>No hay productos</p>";
    return;
  }

  const grupos={};
  filtered.forEach(it=>{
    if(!grupos[it.cat])grupos[it.cat]=[];
    grupos[it.cat].push(it);
  });

  for(const cat in grupos){
    const items=grupos[cat];
    const catDiv=document.createElement("div");
    catDiv.innerHTML=`<div class="cat-title">${cat}</div>
      <div class="resumen">Productos: ${items.length}</div>`;
    items.forEach(it=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <div class="info">
          <div class="name">${it.name}</div>
          <div class="details">${it.qty.toFixed(2)} ${it.unit}</div>
          ${it.min && it.qty < it.min ? `<div class="low">‚ö† Stock bajo</div>` : ""}
        </div>
        <div>
          <button class="btn btn-primary btn-sm" onclick="addOne(${it.id})">+1</button>
          <button class="btn btn-danger btn-sm" onclick="delItem(${it.id})">üóë</button>
        </div>`;
      catDiv.appendChild(div);
    });
    list.appendChild(catDiv);
  }
}

q("#search").addEventListener("input",e=>{
  searchTerm=e.target.value.toLowerCase();
  render();
});

function openAdd(){q("#modalAdd").style.display="flex";}
function closeAdd(){q("#modalAdd").style.display="none";}

function addItem(){
  const name=q("#addName").value.trim();
  const qty=parseFloat(q("#addQty").value);
  const min=parseFloat(q("#addMin").value)||0;
  const unit=q("#addUnit").value;
  const cat=q("#addCat").value;
  if(!name||isNaN(qty)){alert("Datos inv√°lidos");return;}
  data.push({id:Date.now(),name,qty,unit,cat,min});
  closeAdd();save();
}

function delItem(id){
  if(confirm("¬øEliminar producto?")){
    data=data.filter(x=>x.id!==id);
    save();
  }
}

function addOne(id){
  const it=data.find(x=>x.id===id);
  if(it){it.qty+=1;save();}
}

function exportCSV(){
  if(data.length===0){alert("No hay productos");return;}
  let csv="Nombre,Cantidad,Unidad,Categor√≠a,Stock m√≠nimo\n";
  data.forEach(it=>{
    csv+=`${it.name},${it.qty},${it.unit},${it.cat},${it.min||0}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="inventario.csv";
  a.click();
}

render();
</script>
</body>
</html>
